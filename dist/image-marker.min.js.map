{"version":3,"sources":["webpack:///image-marker.min.js","webpack:///webpack/bootstrap d7438b9e33815daa4188","webpack:///./src/index.js","webpack:///./src/util.js"],"names":["window","modules","__webpack_require__","moduleId","installedModules","exports","module","i","l","call","m","c","d","name","getter","o","Object","defineProperty","configurable","enumerable","get","n","__esModule","object","property","prototype","hasOwnProperty","p","s","_classCallCheck","instance","Constructor","TypeError","value","_createClass","defineProperties","target","props","length","descriptor","writable","key","protoProps","staticProps","_util","ImageMarker","opts","arguments","undefined","markerSelector","document","this","_window","_document","_images","_markerSelector","_eventListeners","_debouncedLayout","debounce","layout","bind","_addEventListeners","registerMarkers","selector","width","height","markers","marker","data","dataset","imgNode","querySelector","img","_registerImage","naturalWidth","naturalHeight","id","assign","left","parseInt","top","cropWidth","atLeast","minWidth","cropHeight","minHeight","_this","querySelectorAll","forEach","_registerMarker","_this2","keys","imgSelector","image","imageNode","currentWidth","clientWidth","currentHeight","clientHeight","markerId","xFactor","yFactor","setAttribute","_this3","remove","_removeEventListeners","_removeMarkers","event","fn","addEventListener","passive","removeEventListener","_this4","_addEventListener","default","min","val","Math","max","func","wait","immediate","timeout","later","apply","context","args","callNow","clearTimeout","setTimeout"],"mappings":"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","file":"image-marker.min.js","sourcesContent":["window[\"ImageMarker\"] =\n/******/ (function(modules) { // webpackBootstrap\n/******/ \t// The module cache\n/******/ \tvar installedModules = {};\n/******/\n/******/ \t// The require function\n/******/ \tfunction __webpack_require__(moduleId) {\n/******/\n/******/ \t\t// Check if module is in cache\n/******/ \t\tif(installedModules[moduleId]) {\n/******/ \t\t\treturn installedModules[moduleId].exports;\n/******/ \t\t}\n/******/ \t\t// Create a new module (and put it into the cache)\n/******/ \t\tvar module = installedModules[moduleId] = {\n/******/ \t\t\ti: moduleId,\n/******/ \t\t\tl: false,\n/******/ \t\t\texports: {}\n/******/ \t\t};\n/******/\n/******/ \t\t// Execute the module function\n/******/ \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n/******/\n/******/ \t\t// Flag the module as loaded\n/******/ \t\tmodule.l = true;\n/******/\n/******/ \t\t// Return the exports of the module\n/******/ \t\treturn module.exports;\n/******/ \t}\n/******/\n/******/\n/******/ \t// expose the modules object (__webpack_modules__)\n/******/ \t__webpack_require__.m = modules;\n/******/\n/******/ \t// expose the module cache\n/******/ \t__webpack_require__.c = installedModules;\n/******/\n/******/ \t// define getter function for harmony exports\n/******/ \t__webpack_require__.d = function(exports, name, getter) {\n/******/ \t\tif(!__webpack_require__.o(exports, name)) {\n/******/ \t\t\tObject.defineProperty(exports, name, {\n/******/ \t\t\t\tconfigurable: false,\n/******/ \t\t\t\tenumerable: true,\n/******/ \t\t\t\tget: getter\n/******/ \t\t\t});\n/******/ \t\t}\n/******/ \t};\n/******/\n/******/ \t// getDefaultExport function for compatibility with non-harmony modules\n/******/ \t__webpack_require__.n = function(module) {\n/******/ \t\tvar getter = module && module.__esModule ?\n/******/ \t\t\tfunction getDefault() { return module['default']; } :\n/******/ \t\t\tfunction getModuleExports() { return module; };\n/******/ \t\t__webpack_require__.d(getter, 'a', getter);\n/******/ \t\treturn getter;\n/******/ \t};\n/******/\n/******/ \t// Object.prototype.hasOwnProperty.call\n/******/ \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n/******/\n/******/ \t// __webpack_public_path__\n/******/ \t__webpack_require__.p = \"\";\n/******/\n/******/ \t// Load entry module and return exports\n/******/ \treturn __webpack_require__(__webpack_require__.s = 0);\n/******/ })\n/************************************************************************/\n/******/ ([\n/* 0 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _util = __webpack_require__(1);\n\n__webpack_require__(2);\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar ImageMarker = function () {\n  function ImageMarker() {\n    var opts = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {\n      markerSelector: \".img-marker\",\n      document: document,\n      window: window\n    };\n\n    _classCallCheck(this, ImageMarker);\n\n    this._window = opts.window;\n    this._document = opts.document;\n    this._images = {};\n    this._markerSelector = opts.markerSelector;\n    this._eventListeners = {};\n    this._debouncedLayout = (0, _util.debounce)(this.layout.bind(this));\n\n    this._addEventListeners();\n    this.registerMarkers();\n  }\n\n  _createClass(ImageMarker, [{\n    key: \"_registerImage\",\n    value: function _registerImage(selector, width, height) {\n      if (!this._images[selector]) {\n        this._images[selector] = { width: width, height: height, markers: [] };\n      }\n      this._images[selector].width = width;\n      this._images[selector].height = height;\n      return this._images[selector];\n    }\n  }, {\n    key: \"_registerMarker\",\n    value: function _registerMarker(marker) {\n      var data = marker.dataset;\n      var imgNode = this._document.querySelector(data.img);\n      var img = this._registerImage(data.img, imgNode.naturalWidth, imgNode.naturalHeight);\n\n      if (!img.markers[marker.id]) {\n        img.markers[marker.id] = { id: marker.id };\n      }\n\n      img.markers[marker.id] = Object.assign(img.markers[marker.id], {\n        left: parseInt(data.left),\n        top: parseInt(data.top),\n        width: parseInt(data.width),\n        height: parseInt(data.height),\n        cropWidth: (0, _util.atLeast)(parseInt(data.minWidth || 0)),\n        cropHeight: (0, _util.atLeast)(parseInt(data.minHeight || 0))\n      });\n    }\n  }, {\n    key: \"registerMarkers\",\n    value: function registerMarkers() {\n      var _this = this;\n\n      var imgMarkers = this._document.querySelectorAll(this._markerSelector);\n      imgMarkers.forEach(function (marker) {\n        return _this._registerMarker(marker);\n      });\n      this.layout();\n    }\n  }, {\n    key: \"layout\",\n    value: function layout() {\n      var _this2 = this;\n\n      Object.keys(this._images).forEach(function (imgSelector) {\n        var image = _this2._images[imgSelector];\n        var imageNode = _this2._document.querySelector(imgSelector);\n        var currentWidth = imageNode.clientWidth;\n        var currentHeight = imageNode.clientHeight;\n\n        Object.keys(image.markers).forEach(function (markerId) {\n          var marker = image.markers[markerId];\n          var xFactor = currentWidth / image.width;\n          var yFactor = currentHeight / image.height;\n          var height = marker.cropHeight(marker.height * yFactor);\n          var width = marker.cropWidth(marker.width * xFactor);\n\n          var top = marker.top * yFactor - height / 2;\n          var left = marker.left * xFactor - width / 2;\n\n          var markerNode = _this2._document.querySelector(\"#\" + marker.id);\n          markerNode.setAttribute(\"style\", \"top:\" + top + \"px;left:\" + left + \"px;width:\" + width + \"px;height:\" + height + \"px;\");\n        });\n      });\n    }\n  }, {\n    key: \"_removeMarkers\",\n    value: function _removeMarkers() {\n      var _this3 = this;\n\n      Object.keys(this._images).forEach(function (image) {\n        return _this3._images[image].markers.forEach(function (marker) {\n          return document.querySelector(\"#\" + marker.id).remove();\n        });\n      });\n    }\n  }, {\n    key: \"destroy\",\n    value: function destroy() {\n      // free memory!\n      this._removeEventListeners();\n      this._removeMarkers();\n      this._images = null;\n      this._document = null;\n      this._window = null;\n      this._eventListeners = null;\n    }\n  }, {\n    key: \"_addEventListener\",\n    value: function _addEventListener(event, fn) {\n      var target = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : this._window;\n\n      if (!this._eventListeners[event]) {\n        target.addEventListener(event, fn, { passive: true });\n        this._eventListeners[event] = function () {\n          return target.removeEventListener(event, fn);\n        };\n      }\n    }\n  }, {\n    key: \"_removeEventListeners\",\n    value: function _removeEventListeners() {\n      var _this4 = this;\n\n      Object.keys(this._eventListeners).forEach(function (event) {\n        return _this4._eventListeners[event]();\n      });\n    }\n  }, {\n    key: \"_addEventListeners\",\n    value: function _addEventListeners() {\n      this._addEventListener(\"load\", this.registerMarkers.bind(this));\n      //Cope with window being resized whilst on another tab\n      this._addEventListener(\"focus\", this._debouncedLayout);\n      this._addEventListener(\"resize\", this._debouncedLayout);\n      this._addEventListener(\"readystatechange\", this._debouncedLayout);\n      this._addEventListener(\"fullscreenchange\", this._debouncedLayout, this._document);\n    }\n  }]);\n\n  return ImageMarker;\n}();\n\nexports.default = ImageMarker;\n\n/***/ }),\n/* 1 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.atLeast = atLeast;\nexports.debounce = debounce;\nfunction atLeast(min) {\n  return function (val) {\n    return Math.max(min, val);\n  };\n}\n\nfunction debounce(func) {\n  var wait = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 100;\n  var immediate = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;\n\n  var timeout = void 0;\n\n  return function () {\n    var context = this;\n    var args = arguments;\n\n    function later() {\n      timeout = null;\n      if (!immediate) {\n        func.apply(context, args);\n      }\n    }\n\n    var callNow = immediate && !timeout;\n    clearTimeout(timeout);\n    timeout = setTimeout(later, wait);\n    if (callNow) {\n      func.apply(context, args);\n    };\n  };\n}\n\n/***/ }),\n/* 2 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n// removed by extract-text-webpack-plugin\n\n\n/***/ })\n/******/ ])[\"default\"];\n\n\n// WEBPACK FOOTER //\n// image-marker.min.js"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 0);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap d7438b9e33815daa4188","import { debounce, atLeast } from \"./util\";\nimport \"./style.css\";\n\nexport default class ImageMarker {\n  constructor(\n    opts = {\n      markerSelector: \".img-marker\",\n      document: document,\n      window: window\n    }\n  ) {\n    this._window = opts.window;\n    this._document = opts.document;\n    this._images = {};\n    this._markerSelector = opts.markerSelector;\n    this._eventListeners = {};\n    this._debouncedLayout = debounce(this.layout.bind(this));\n\n    this._addEventListeners();\n    this.registerMarkers();\n  }\n\n  _registerImage(selector, width, height) {\n    if (!this._images[selector]) {\n      this._images[selector] = { width, height, markers: [] };\n    }\n    this._images[selector].width = width;\n    this._images[selector].height = height;\n    return this._images[selector];\n  }\n\n  _registerMarker(marker) {\n    const data = marker.dataset;\n    const imgNode = this._document.querySelector(data.img);\n    const img = this._registerImage(\n      data.img,\n      imgNode.naturalWidth,\n      imgNode.naturalHeight\n    );\n\n    if (!img.markers[marker.id]) {\n      img.markers[marker.id] = { id: marker.id };\n    }\n\n    img.markers[marker.id] = Object.assign(img.markers[marker.id], {\n      left: parseInt(data.left),\n      top: parseInt(data.top),\n      width: parseInt(data.width),\n      height: parseInt(data.height),\n      cropWidth: atLeast(parseInt(data.minWidth || 0)),\n      cropHeight: atLeast(parseInt(data.minHeight || 0))\n    });\n  }\n\n  registerMarkers() {\n    const imgMarkers = this._document.querySelectorAll(this._markerSelector);\n    imgMarkers.forEach(marker => this._registerMarker(marker));\n    this.layout();\n  }\n\n  layout() {\n    Object.keys(this._images).forEach(imgSelector => {\n      const image = this._images[imgSelector];\n      const imageNode = this._document.querySelector(imgSelector);\n      const currentWidth = imageNode.clientWidth;\n      const currentHeight = imageNode.clientHeight;\n\n      Object.keys(image.markers).forEach(markerId => {\n        const marker = image.markers[markerId];\n        const xFactor = currentWidth / image.width;\n        const yFactor = currentHeight / image.height;\n        const height = marker.cropHeight(marker.height * yFactor);\n        const width = marker.cropWidth(marker.width * xFactor);\n\n        const top = marker.top * yFactor - height / 2;\n        const left = marker.left * xFactor - width / 2;\n\n        const markerNode = this._document.querySelector(\"#\" + marker.id);\n        markerNode.setAttribute(\n          \"style\",\n          `top:${top}px;left:${left}px;width:${width}px;height:${height}px;`\n        );\n      });\n    });\n  }\n\n  _removeMarkers() {\n    Object.keys(this._images).forEach(image =>\n      this._images[image].markers.forEach(marker =>\n        document.querySelector(\"#\" + marker.id).remove()\n      )\n    );\n  }\n\n  destroy() {\n    // free memory!\n    this._removeEventListeners();\n    this._removeMarkers();\n    this._images = null;\n    this._document = null;\n    this._window = null;\n    this._eventListeners = null;\n  }\n\n  _addEventListener(event, fn, target = this._window) {\n    if (!this._eventListeners[event]) {\n      target.addEventListener(event, fn, { passive: true });\n      this._eventListeners[event] = () => target.removeEventListener(event, fn);\n    }\n  }\n\n  _removeEventListeners() {\n    Object.keys(this._eventListeners).forEach(event =>\n      this._eventListeners[event]()\n    );\n  }\n\n  _addEventListeners() {\n    this._addEventListener(\"load\", this.registerMarkers.bind(this));\n    //Cope with window being resized whilst on another tab\n    this._addEventListener(\"focus\", this._debouncedLayout);\n    this._addEventListener(\"resize\", this._debouncedLayout);\n    this._addEventListener(\"readystatechange\", this._debouncedLayout);\n    this._addEventListener(\n      \"fullscreenchange\",\n      this._debouncedLayout,\n      this._document\n    );\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/index.js","export function atLeast(min) {\n  return val => Math.max(min, val);\n}\n\nexport function debounce(func, wait = 100, immediate = false) {\n  let timeout;\n\n  return function() {\n    const context = this;\n    const args = arguments;\n\n    function later() {\n      timeout = null;\n      if (!immediate) {\n        func.apply(context, args);\n      }\n    }\n\n    const callNow = immediate && !timeout;\n    clearTimeout(timeout);\n    timeout = setTimeout(later, wait);\n    if (callNow) {\n      func.apply(context, args)\n    };\n  };\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/util.js"],"sourceRoot":""}